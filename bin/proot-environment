#!/bin/bash

# dependencies #

source /data/data/com.termux/files/usr/bin/console
source /data/data/com.termux/files/usr/bin/globals

# usage #

# variables #

script=$(basename -- "${BASH_SOURCE[0]}")

# directories

console.info "Creating directories."
echo

system_directories_list=(
	backgrounds
	fonts
)

for directory in ${system_directories_list[@]}
do
	console.fwd "Creating directory [ ${directory} ]."
	echo

	# create directory and set permissions

	[ ! -d "$PROOT_DIRECTORY"/usr/share/"${directory}" ] && mkdir -p "$PROOT_DIRECTORY"/usr/share/"${directory}" || :
	
	# set ownership
	
	chown ${uid}:${gid} -R "$PROOT_DIRECTORY"/usr/share/"${directory}"
done

# files #

# environment

console.info "Setting library preload."
echo

cat <<- "FILE" >> "$PROOT_DIRECTORY"/etc/environment
LD_PRELOAD=/lib/aarch64-linux-gnu/libgcc_s.so.1:/lib/libandroid-shmem-aarch64.so
FILE

# hostname

console.info "Setting hostname."
echo

echo ${hostname} > "$PROOT_DIRECTORY"/etc/hostname

console.info "Setting host address."
echo

# hosts

cat <<- 'FILE' > "$PROOT_DIRECTORY"/etc/hosts
127.0.0.1 localhost.localdomain
127.0.0.1 localhost
FILE

echo "127.0.0.1 ${hostname}" >> "$PROOT_DIRECTORY"/etc/hosts

# nameserver

console.info "Setting namserver address."
echo

cat <<- 'FILE' > "$PROOT_DIRECTORY"/etc/resolv.conf
nameserver 8.8.8.8
FILE

# profile

# automatic setup transition [ termux >>> [ proot ] ]

cat <<- 'FILE' >> "$PROOT_DIRECTORY"/root/.profile

bash /tmp/setup
FILE
